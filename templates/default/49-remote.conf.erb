# Create on-disk queue for forwarded messages. If the remote host is
# down, messages are spooled to disk and sent when it is up again.
$ActionQueueFileName fwd # unique name prefix for spool files
$ActionQueueMaxDiskSpace 1g   # 1gb space limit (use as much as possible)
$ActionQueueSaveOnShutdown on # save messages to disk on shutdown
$ActionQueueType LinkedList   # run asynchronously
$ActionResumeRetryCount -1    # infinite retries if host is down
<% if node['rsyslog']['tls'] -%>
<% if node['rsyslog']['tls_authenticate_server'] -%>
<% if node['rsyslog']['tls_server_name'] -%>
$ActionSendStreamDriverAuthMode x509/name
$ActionSendStreamDriverPermittedPeer <%= node['rsyslog']['tls_server_name'] %>
<% end %>
<% else -%>
$ActionSendStreamDriverAuthMode anon
<% end -%>
$ActionSendStreamDriverMode 1
<% end -%>
<% case @protocol -%>
<% when "tcp" -%>
*.* @@(<%= "o," if node['rsyslog']['tls'] %>z3)<%= @server %>:<%= node['rsyslog']['port'] %>
<% when "udp" -%>
*.* @<%= @server %>:<%= node['rsyslog']['port'] %>
<% end -%>
